require 'capybara'
require 'capybara/cucumber'
require 'cucumber'
require 'selenium/webdriver'
require 'rubygems'

site = "www.photodeuxbulots.com/australia/wp-admin"
$debug_mode = true if ENV['DEBUG']

Capybara.register_driver :selenium_chrome do |app|
  client = Selenium::WebDriver::Remote::Http::Default.new
  # WORKAROUND failure at Scenario: Test IPMI functions: increase from 60 s to 180 s
  client.read_timeout = 180
  # Chrome driver options
  chrome_options = %w[no-sandbox disable-dev-shm-usage ignore-certificate-errors disable-gpu window-size=2048,2048, js-flags=--max_old_space_size=2048]
  # chrome_options << 'headless' unless $sdebug_mode
  capabilities = Selenium::WebDriver::Remote::Capabilities.chrome(
    chromeOptions: {
      args: chrome_options,
      w3c: false,
      prefs: {
        'download.default_directory': '/tmp/downloads'
      }
    },
    unexpectedAlertBehaviour: 'accept',
    unhandledPromptBehavior: 'accept'
  )

  Capybara::Selenium::Driver.new(
    app,
    browser: :chrome,
    desired_capabilities: capabilities,
    http_client: client
  )
end

Selenium::WebDriver.logger.level = :error unless $debug_mode
# Capybara.default_driver = :headless_chrome
# Capybara.javascript_driver = :headless_chrome
Capybara.default_normalize_ws = true
Capybara.app_host = "https://#{site}"
# Capybara.server_port = 8888 + ENV['TEST_ENV_NUMBER'].to_i
# STDOUT.puts "Capybara APP Host: #{Capybara.app_host}:#{Capybara.server_port}"